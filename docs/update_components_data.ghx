<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<Archive name="Root">
  <!--Grasshopper archive-->
  <!--Grasshopper and GH_IO.dll are copyrighted by Robert McNeel & Associates-->
  <!--Archive generated by GH_IO.dll file utility library {0.2.0002}-->
  <items count="1">
    <item name="ArchiveVersion" type_name="gh_version" type_code="80">
      <Major>0</Major>
      <Minor>2</Minor>
      <Revision>2</Revision>
    </item>
  </items>
  <chunks count="1">
    <chunk name="Definition">
      <items count="1">
        <item name="plugin_version" type_name="gh_version" type_code="80">
          <Major>1</Major>
          <Minor>0</Minor>
          <Revision>7</Revision>
        </item>
      </items>
      <chunks count="5">
        <chunk name="DocumentHeader">
          <items count="5">
            <item name="DocumentID" type_name="gh_guid" type_code="9">d7164788-7c5e-4bf0-9e6c-cb77badca286</item>
            <item name="Preview" type_name="gh_string" type_code="10">Shaded</item>
            <item name="PreviewMeshType" type_name="gh_int32" type_code="3">1</item>
            <item name="PreviewNormal" type_name="gh_drawing_color" type_code="36">
              <ARGB>100;150;0;0</ARGB>
            </item>
            <item name="PreviewSelected" type_name="gh_drawing_color" type_code="36">
              <ARGB>100;0;150;0</ARGB>
            </item>
          </items>
        </chunk>
        <chunk name="DefinitionProperties">
          <items count="3">
            <item name="Date" type_name="gh_date" type_code="8">637235848187990285</item>
            <item name="Description" type_name="gh_string" type_code="10"></item>
            <item name="Name" type_name="gh_string" type_code="10">update_components_data.ghx</item>
          </items>
          <chunks count="3">
            <chunk name="Revisions">
              <items count="1">
                <item name="RevisionCount" type_name="gh_int32" type_code="3">0</item>
              </items>
            </chunk>
            <chunk name="Projection">
              <items count="2">
                <item name="Target" type_name="gh_drawing_point" type_code="30">
                  <X>82</X>
                  <Y>86</Y>
                </item>
                <item name="Zoom" type_name="gh_single" type_code="5">1.38408291</item>
              </items>
            </chunk>
            <chunk name="Views">
              <items count="1">
                <item name="ViewCount" type_name="gh_int32" type_code="3">0</item>
              </items>
            </chunk>
          </chunks>
        </chunk>
        <chunk name="RcpLayout">
          <items count="1">
            <item name="GroupCount" type_name="gh_int32" type_code="3">0</item>
          </items>
        </chunk>
        <chunk name="GHALibraries">
          <items count="1">
            <item name="Count" type_name="gh_int32" type_code="3">1</item>
          </items>
          <chunks count="1">
            <chunk name="Library" index="0">
              <items count="6">
                <item name="AssemblyFullName" type_name="gh_string" type_code="10">GhPython, Version=7.0.20309.6003, Culture=neutral, PublicKeyToken=null</item>
                <item name="AssemblyVersion" type_name="gh_string" type_code="10">7.0.20309.6003</item>
                <item name="Author" type_name="gh_string" type_code="10"></item>
                <item name="Id" type_name="gh_guid" type_code="9">00000000-0000-0000-0000-000000000000</item>
                <item name="Name" type_name="gh_string" type_code="10"></item>
                <item name="Version" type_name="gh_string" type_code="10"></item>
              </items>
            </chunk>
          </chunks>
        </chunk>
        <chunk name="DefinitionObjects">
          <items count="1">
            <item name="ObjectCount" type_name="gh_int32" type_code="3">3</item>
          </items>
          <chunks count="3">
            <chunk name="Object" index="0">
              <items count="3">
                <item name="GUID" type_name="gh_guid" type_code="9">410755b1-224a-4c1e-a407-bf32fb45ea7e</item>
                <item name="Lib" type_name="gh_guid" type_code="9">00000000-0000-0000-0000-000000000000</item>
                <item name="Name" type_name="gh_string" type_code="10">GhPython Script</item>
              </items>
              <chunks count="1">
                <chunk name="Container">
                  <items count="13">
                    <item name="CodeInput" type_name="gh_string" type_code="10">import os
import os.path as op
import shutil
import json
from collections import namedtuple, defaultdict

import clr
clr.AddReference('System.Core')
clr.AddReference('RhinoInside.Revit')
clr.AddReference('RevitAPI') 
clr.AddReference('RevitAPIUI')

from System import Enum
from System.Reflection import BindingFlags

import rhinoscriptsyntax as rs
import Rhino
import RhinoInside
import Grasshopper
from Grasshopper.Kernel import GH_RuntimeMessageLevel as RML
from RhinoInside.Revit import Revit, Convert
from Autodesk.Revit import DB

from Rhino.NodeInCode import Components as ghc

# =============================================================================
# configs
# script assumes the GH def file is in root of docs/ folder
DOCS_PATH = op.dirname(ghdoc.Path)
# target components data file, to be generated
DATA_FILE = r'_data\components.json'
ICONS_SRC = r'../art/gh-icons/'
ICONS_DST = r'static/images/GH'
ICONS_ROOT = r'static/images/GH/{}.png'
# =============================================================================

class ComplexEncoder(json.JSONEncoder):
    """Json serializer to be passed to json.dumps()"""
    def default(self, obj):
        return {
            "uuid": obj.uuid,
            "typename": obj.typename,
            "title": obj.title,
            "desc": obj.desc,
            "iconsrc": obj.iconsrc,
            "icontag": obj.icontag,
            "tab": obj.tab,
            "panel": obj.panel,
        }

class Component(object):
    """Component data type. Extracts properties from given type"""
    def __init__(self, ctype):
        self._valid = True
        self._exposure = -1
        try:
            t = ctype()
            # component uuid
            self.uuid = str(t.ComponentGuid)
            self.typename = ctype.Name
            # name as title
            self.title = t.Name
            self.desc = str(t.Description).replace(".", "")
            # assymes icon file name matches stripped version of type name
            # e.g. Add Wall --&gt; AddWall.png
            icon_file = ICONS_ROOT.format(''.join(self.typename.strip().split()))
            type_icon_file = ICONS_ROOT.format(self.typename)
            self.iconsrc = None
            for icon_opt in [icon_file, type_icon_file]:
                full_icon_path = op.normpath(op.join(DOCS_PATH, icon_opt))
                if op.exists(full_icon_path):
                    self.iconsrc = '/' + icon_opt
                    break
            # if no icon exits, get the icon tag
            self.icontag = None
            if not self.iconsrc:
                self.icontag = t.IconTag if hasattr(t, 'IconTag') else self.typename[0].upper()
            # component group
            self.tab = t.Category
            self.panel = t.SubCategory
            # component exposure
            self._exposure = int(t.Exposure) if hasattr(t, 'Exposure') else int(Grasshopper.Kernel.GH_Exposure.primary)
        except Exception as ex:
            self._valid = False

    @property
    def is_valid(self):
        """If component has extracted all the availabe info"""
        return self._valid

    @property
    def is_hidden(self):
        """If component is marked as hidden in GH GUI"""
        return self._exposure == int(Grasshopper.Kernel.GH_Exposure.hidden)


def get_nodes_from_assm():
    """Extract GH types from RhinoInside.Revit.GH assembly"""
    comps = []
    for t in clr.LoadAssemblyByName("RhinoInside.Revit.GH").GetExportedTypes():
        namespace = str(t.Namespace)
        if any(namespace.startswith(x) for x in ['RhinoInside.Revit.GH.Components', 'RhinoInside.Revit.GH.Parameters']):
            c = Component(t)
            # if component is valid and not hidden,
            # then filter for the onces in Revit tab or panel only
            if c.is_valid and not c.is_hidden \
                    and (c.tab == 'Revit' or c.panel == 'Revit Primitives'):
                comps.append(c)
    return comps

# copy all icons into docs
for iconsdir in ['comps', 'params']:
    iconsdir_path = op.abspath(op.join(DOCS_PATH, ICONS_SRC, iconsdir))
    icons_dest = op.join(DOCS_PATH, ICONS_DST)
    for file_name in os.listdir(iconsdir_path):
        if file_name.endswith('.png'):
            full_file_name = os.path.join(iconsdir_path, file_name)
            if os.path.isfile(full_file_name):
                shutil.copy(full_file_name, icons_dest)

# dump to json
comps_data = json.dumps(
    get_nodes_from_assm(),
    cls=ComplexEncoder,
    sort_keys=True,
    indent=2
    )

# set output
CompsData = comps_data
# write to data file
with open(op.join(DOCS_PATH, DATA_FILE), 'w') as f:
    f.write(comps_data)</item>
                    <item name="Description" type_name="gh_string" type_code="10">GhPython provides a Python script component</item>
                    <item name="EditorLocation" type_name="gh_drawing_point" type_code="30">
                      <X>245</X>
                      <Y>107</Y>
                    </item>
                    <item name="EditorSize" type_name="gh_drawing_size" type_code="32">
                      <W>993</W>
                      <H>772</H>
                    </item>
                    <item name="HideInput" type_name="gh_bool" type_code="1">true</item>
                    <item name="HideOutput" type_name="gh_bool" type_code="1">true</item>
                    <item name="IconOverride" type_name="gh_drawing_bitmap" type_code="37">
                      <bitmap length="1173">iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABGdBTUEAALGPC/xhBQAABExJREFUSEudlm1MW2UUx9sCbccECpgRDGPOZYnJsrFAcEZDMqdmujEW5xjQTMwyozEzcX4hfjBhxhD9oLKxQZh+UEfiFjdNnGRuoKMDYcMxENYNS4EW+nr7dm976euQv/c8HXTdAsbe5J+e+zznnt+55znPcyuXLXNpNJpKlULVEUNMs5wPjSvlSiG6EH1DEITOlfwemVuTV8D/2nwZodEIxIEg/FfmwF8Q4f3WD3cLD2eTF7YGDucqf0SB5Pu/gpNzbm4uhIsijpe0orqoFifK2mDea4f5tfuSbFOVDfqXjCDflACedgHVxbXYW7QPNeu1mK1xwlLHMZE9W81h7FVD6gDuYy9ObmtHzQYtWitOw17vgeOQl4ls60E3RnbrUwfYj7ilIC4W0PmWF9w7PLh370uyaWxoz9jKgFJZeWWZ4hl+s2wrHlTxqnVJ94tznqMBML3vh+uIgBt7hlGsfhKbZJuTtFVWxm+RlVbKSuXlfE9zL8KTEQSHwxCvhRC4FIRwXoRwZg5Cu9Q9zdLvZ0HwjZI+jMvXMAfvByL6KgfZGwTPRSEcC8FV44elxIMLGZ2QID4ZZRboC8JQYcbkyxbWGbR4VF8qAWVJgSio/6MwAsciTGTTWM/ufgawZwuwPubDbKYHZrULt5VT7I0YgL8YwMR2M6Z2WlkrUofQIlLNqRSULQUUP4ki9Ok9JrJprOsVHQM48vywZfGwZHoZYFQ1kQB4zggSYCYOkPqc2tCkteGu1ojbWgNG68fx1yE9hg+PYejwKK7XD+HagX50V+nw+bPHUZS/NsatE5cAM5ku3FLeTQC4Fk8SYOJ1M9q2f7VQWFgYo+xW0trHi2Nnn/ppgXsikAT4UzmWANgauaQSDe/Ug4J3N15FVDePyM+SOiSdmke4SVLDPwi+PQ+xJgZhRxiejUE4cpJLNJAxkgDMvGdPWuSBF4ZY1qGzMXA5ItyaILx5IfjypYXNjzKRTWM0Rz4PL3Jvxs0EYKrOAsPzZhhfnMX0Lht0FfHOENsicGT7wWniEE9uiAUlkc2CS3Pks7jAVH+TmsPVjOsJwN87TBh/zrS0Dl3b4p3hbwrBniXEIVKWrpy5JNEYzZHPgy06rXaiO/2POIA22tdF3+Hy0z24tOl3dG7pRmdJFwP4js6xByk7KgEFc+YEYM32wZTlhHG1DXcyTRhbZcQt9R3cUI2iTznEsv9G8T1tNF7GjgrZo0cFAdxvBtjGod5eBD18JCx3v3RULHeOs82zi2ebhuq6CLJvlDbfQRGBkyFEBu+BrpS/B9ZyD6ietGgEWoS1qE7jQJoWJ5TtoH5PGWBa78Ck0o4plYOJYKTqtDpUpe1jv11pfakDDFkWTGRYmYxKG4ORmtPbsF9eiy/TW3Fe/ktqgDWrC/gO5Q8YV8xAnzaNkXQDbir0GFCMQKcYxG+KflyR9+IL1SkUaFL46NPfFnrwv84i8iHf5ZrlX42oK5TTXDe4AAAAAElFTkSuQmCC</bitmap>
                    </item>
                    <item name="InputIsPath" type_name="gh_bool" type_code="1">false</item>
                    <item name="InstanceGuid" type_name="gh_guid" type_code="9">def0e960-a4de-4223-9649-8a37cf4905b7</item>
                    <item name="IsAdvancedMode" type_name="gh_bool" type_code="1">false</item>
                    <item name="MarshalOutGuids" type_name="gh_bool" type_code="1">true</item>
                    <item name="Name" type_name="gh_string" type_code="10">GhPython Script</item>
                    <item name="NickName" type_name="gh_string" type_code="10">GhPython Script</item>
                  </items>
                  <chunks count="2">
                    <chunk name="Attributes">
                      <items count="3">
                        <item name="Bounds" type_name="gh_drawing_rectanglef" type_code="35">
                          <X>110</X>
                          <Y>177</Y>
                          <W>97</W>
                          <H>28</H>
                        </item>
                        <item name="Pivot" type_name="gh_drawing_pointf" type_code="31">
                          <X>124</X>
                          <Y>191</Y>
                        </item>
                        <item name="Selected" type_name="gh_bool" type_code="1">true</item>
                      </items>
                    </chunk>
                    <chunk name="ParameterData">
                      <items count="3">
                        <item name="InputCount" type_name="gh_int32" type_code="3">0</item>
                        <item name="OutputCount" type_name="gh_int32" type_code="3">1</item>
                        <item name="OutputId" index="0" type_name="gh_guid" type_code="9">8ec86459-bf01-4409-baee-174d0d2b13d0</item>
                      </items>
                      <chunks count="1">
                        <chunk name="OutputParam" index="0">
                          <items count="6">
                            <item name="Description" type_name="gh_string" type_code="10">Script output CompsData.</item>
                            <item name="InstanceGuid" type_name="gh_guid" type_code="9">611ecdcb-f988-4778-b7fe-24f6d6f3dc72</item>
                            <item name="Name" type_name="gh_string" type_code="10">CompsData</item>
                            <item name="NickName" type_name="gh_string" type_code="10">CompsData</item>
                            <item name="Optional" type_name="gh_bool" type_code="1">false</item>
                            <item name="SourceCount" type_name="gh_int32" type_code="3">0</item>
                          </items>
                          <chunks count="1">
                            <chunk name="Attributes">
                              <items count="3">
                                <item name="Bounds" type_name="gh_drawing_rectanglef" type_code="35">
                                  <X>139</X>
                                  <Y>179</Y>
                                  <W>66</W>
                                  <H>24</H>
                                </item>
                                <item name="Pivot" type_name="gh_drawing_pointf" type_code="31">
                                  <X>172</X>
                                  <Y>191</Y>
                                </item>
                                <item name="Selected" type_name="gh_bool" type_code="1">true</item>
                              </items>
                            </chunk>
                          </chunks>
                        </chunk>
                      </chunks>
                    </chunk>
                  </chunks>
                </chunk>
              </chunks>
            </chunk>
            <chunk name="Object" index="1">
              <items count="2">
                <item name="GUID" type_name="gh_guid" type_code="9">59e0b89a-e487-49f8-bab8-b5bab16be14c</item>
                <item name="Name" type_name="gh_string" type_code="10">Panel</item>
              </items>
              <chunks count="1">
                <chunk name="Container">
                  <items count="9">
                    <item name="Description" type_name="gh_string" type_code="10">A panel for custom notes and text values</item>
                    <item name="InstanceGuid" type_name="gh_guid" type_code="9">12882f19-3bdd-47d6-a263-c5ec35f220d8</item>
                    <item name="Name" type_name="gh_string" type_code="10">Panel</item>
                    <item name="NickName" type_name="gh_string" type_code="10"></item>
                    <item name="Optional" type_name="gh_bool" type_code="1">false</item>
                    <item name="ScrollRatio" type_name="gh_double" type_code="6">1</item>
                    <item name="Source" index="0" type_name="gh_guid" type_code="9">611ecdcb-f988-4778-b7fe-24f6d6f3dc72</item>
                    <item name="SourceCount" type_name="gh_int32" type_code="3">1</item>
                    <item name="UserText" type_name="gh_string" type_code="10">Double click to edit panel content…</item>
                  </items>
                  <chunks count="2">
                    <chunk name="Attributes">
                      <items count="5">
                        <item name="Bounds" type_name="gh_drawing_rectanglef" type_code="35">
                          <X>255</X>
                          <Y>65</Y>
                          <W>647</W>
                          <H>252</H>
                        </item>
                        <item name="MarginLeft" type_name="gh_int32" type_code="3">0</item>
                        <item name="MarginRight" type_name="gh_int32" type_code="3">0</item>
                        <item name="MarginTop" type_name="gh_int32" type_code="3">0</item>
                        <item name="Pivot" type_name="gh_drawing_pointf" type_code="31">
                          <X>255.4272</X>
                          <Y>65.28323</Y>
                        </item>
                      </items>
                    </chunk>
                    <chunk name="PanelProperties">
                      <items count="7">
                        <item name="Colour" type_name="gh_drawing_color" type_code="36">
                          <ARGB>255;255;255;255</ARGB>
                        </item>
                        <item name="DrawIndices" type_name="gh_bool" type_code="1">true</item>
                        <item name="DrawPaths" type_name="gh_bool" type_code="1">false</item>
                        <item name="Multiline" type_name="gh_bool" type_code="1">true</item>
                        <item name="SpecialCodes" type_name="gh_bool" type_code="1">false</item>
                        <item name="Stream" type_name="gh_bool" type_code="1">false</item>
                        <item name="Wrap" type_name="gh_bool" type_code="1">true</item>
                      </items>
                      <chunks count="1">
                        <chunk name="Font">
                          <items count="2">
                            <item name="Family" type_name="gh_string" type_code="10">Courier New</item>
                            <item name="Size" type_name="gh_single" type_code="5">8</item>
                          </items>
                        </chunk>
                      </chunks>
                    </chunk>
                  </chunks>
                </chunk>
              </chunks>
            </chunk>
            <chunk name="Object" index="2">
              <items count="2">
                <item name="GUID" type_name="gh_guid" type_code="9">7f5c6c55-f846-4a08-9c9a-cfdc285cc6fe</item>
                <item name="Name" type_name="gh_string" type_code="10">Scribble</item>
              </items>
              <chunks count="1">
                <chunk name="Container">
                  <items count="13">
                    <item name="Bold" type_name="gh_bool" type_code="1">true</item>
                    <item name="Ca" type_name="gh_drawing_pointf" type_code="31">
                      <X>105.5635</X>
                      <Y>24.7904</Y>
                    </item>
                    <item name="Cb" type_name="gh_drawing_pointf" type_code="31">
                      <X>464.7661</X>
                      <Y>24.7904</Y>
                    </item>
                    <item name="Cc" type_name="gh_drawing_pointf" type_code="31">
                      <X>464.7661</X>
                      <Y>48.27062</Y>
                    </item>
                    <item name="Cd" type_name="gh_drawing_pointf" type_code="31">
                      <X>105.5635</X>
                      <Y>48.27062</Y>
                    </item>
                    <item name="Description" type_name="gh_string" type_code="10">A quick note</item>
                    <item name="Font" type_name="gh_string" type_code="10">Microsoft Sans Serif</item>
                    <item name="InstanceGuid" type_name="gh_guid" type_code="9">74041acf-f23b-4771-a297-57db930e0638</item>
                    <item name="Italic" type_name="gh_bool" type_code="1">false</item>
                    <item name="Name" type_name="gh_string" type_code="10">Scribble</item>
                    <item name="NickName" type_name="gh_string" type_code="10">Scribble</item>
                    <item name="Size" type_name="gh_single" type_code="5">25</item>
                    <item name="Text" type_name="gh_string" type_code="10">Copy icons before running this</item>
                  </items>
                  <chunks count="1">
                    <chunk name="Attributes">
                      <items count="2">
                        <item name="Bounds" type_name="gh_drawing_rectanglef" type_code="35">
                          <X>100.5635</X>
                          <Y>19.7904</Y>
                          <W>369.2026</W>
                          <H>33.48022</H>
                        </item>
                        <item name="Pivot" type_name="gh_drawing_pointf" type_code="31">
                          <X>105.5635</X>
                          <Y>24.7904</Y>
                        </item>
                      </items>
                    </chunk>
                  </chunks>
                </chunk>
              </chunks>
            </chunk>
          </chunks>
        </chunk>
      </chunks>
    </chunk>
  </chunks>
</Archive>